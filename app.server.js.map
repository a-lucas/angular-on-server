{"version":3,"sources":["angularonserver.es7.js"],"names":[],"mappings":"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","file":"app.server.js","sourcesContent":["import jsdom from './jsdom-with-xmlhttprequest';\n\nconst superDom = jsdom.jsdom;\n\nimport http from 'http';\n\nconst express  = require('express');\n\nimport fs from 'fs';\n\nconst delay = function(ms, func) {\n  return setTimeout(func, ms);\n};\n\nconst interval = function(ms, func) {\n  return setInterval(func, ms);\n};\n\nconst app = express();\n\n\napp.use(\"/dist\", express.static(__dirname + \"/dist/client\"));\napp.use(\"/views\", express.static(__dirname + \"/src/views\"));\napp.use(\"/libs\", express.static(__dirname + \"/libs\"));\n\n\nconst html = fs.readFileSync('index.es7.html', 'utf8');\n\napp.get('/', function(req, res, next) {\n  return res.end(html);\n});\n\nconst products = fs.readFileSync('public/products.html');\n\napp.get('//products.html', function(req, res, next) {\n  return res.end(products);\n});\n\nconst getProducts = (req, res) => {\n\n  const options = {\n    host: 'fake-response.appspot.com',\n    port: 80,\n    path: '/?sleep=5'\n  };\n\n  http.get(options, (response) => {\n    console.log(\"Got response: \" + response.statusCode);\n    return res.end(JSON.stringify([{\n      name: 'test',\n      price: 1\n    },\n      {\n        name: 'test2',\n        price: 2,\n      }]))\n  }).on('error', (e) => {\n    console.log(\"Got error: \" + e.message);\n    return res.send(JSON.stringify([]));\n  });\n\n};\n\napp.get('//products', (req, res, next) => {\n  return getProducts(req, res);\n});\n\napp.get('/products', (req, res, next) => {\n  return getProducts(req, res);\n});\n\napp.get(\"*\", (req, res, next) => {\n  var e, scope;\n  var url = req.url;\n  let document = superDom(html);\n  let window = document.createWindow({\n    localPrefix: 'http://localhost:3002' + url\n  });\n  e = window.document.getElementById('mainctl');\n\n  if (window.angular != null) {\n\n    console.log('Angular is defined');\n\n    scope = window.angular.element(e).scope();\n    scope.$apply(() => {\n      scope.setLocation(req.url);\n      return void 0;\n    });\n\n    return delay(50, function() {\n      console.log(window.document.innerHTML);\n      return res.end(window.document.innerHTML);\n    });\n  } else {\n    console.log('window.angular is not defined');\n    //console.log(window.document.innerHTML);\n    return res.end(window.document.innerHTML);\n\n  }\n});\n\nprocess.on('uncaughtException', (err) => {\n  console.log('Uncaught exception:');\n  console.log(err);\n  return console.log(err.stack);\n});\n\napp.listen(3002);\n\nconsole.log('Listening on port 3002');\n\nlet document = superDom(html);\n\nlet window = document.createWindow({\n  localPrefix: 'http://localhost:3002/'\n});\n"],"sourceRoot":"/source/"}